{% extends "museum_site/main.html" %}
{% load static %}
{% load site_tags %}

{% block style %}
<style>
#tool-info
{
    font-family:monospace;font-size:12pt;
}

#tool-info td
{
    padding:0.25em;
}

#tool-info td.True { background-color:#0F0; text-align:center; }
#tool-info td.False { background-color:#F00; text-align:center; }

input[name=today]
{
    max-width:20%;
    margin-left:8px;
}

#desc
{
    height:200px;
}

#submit-button
{
    width:100%;
}
</style>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function (){
        $("input[name=today]").click(function (){
            var today = new Date();
            $("#date").val(today.toISOString().slice(0,10));
            reload_preview();
        });

        $(".widget input[type=checkbox]").click(function (){
        if ($(this).prop("checked"))
        {
            $(this).parent().addClass("selected");
        }
        else
        {
            $(this).parent().removeClass("selected");
        }
        });
        $(".widget input[type=radio]").click(function (){
            $(this).parent().parent().children().removeClass("selected");
            $(this).parent().addClass("selected");
        });
        init_filters();

        $(".char-limited-widget").each(function (){
            $(this).keyup(function (){
                var len = $(this).val().length;
                var max_chars = $(this).attr("maxlength");
                var remaining = max_chars - len;
                $(this).prev(".chars-remaining").find("span").html(remaining);
            });
        });

        $(".clear-date-widget").click(function (){
            console.log("X");
            $(this).prevAll("input[type=date]").val("");
        });

        $(".todays-date-widget").click(function (){
            var today = new Date();
            $(this).prev("input[type=date]").val(today.toISOString().slice(0,10));
        })

        init_filters();
    });

function init_filters()
{
    $(".filterable").each(function (){
        var filter_input = $(this).find(".widget-filter");
        var filter_clear = $(this).find(".widget-clear");
        var targets = $(this).find("label");

        // Bind clear button
        filter_clear.click(function (){
            $(filter_input).val("");
            filter_input.keyup();
        });

        // Bind filtering
        filter_input.keyup(
            {
                "filter": function (){return $(filter_input).val()},
                "targets": targets
            },
            apply_filter
        );
    });
}

function apply_filter(e)
{
    var filter = e.data.filter();
    var targets = e.data.targets;

    $(targets).each(function (){
        var text = $(this).text().trim().toLowerCase();
        if (text.indexOf(filter) == - 1)
        {
            $(this).hide();
        }
        else
        {
            $(this).show();
        }
    });
}

</script>
{% endblock %}

{% block content %}
{% gblock file %}

<form method="POST" enctype="multipart/form-data" id="upload-form">
{% csrf_token %}
<input name="action" value="add-video" type="hidden">

<div class="field">
    <label for="author">Author<br>
    </label>
    <input id="author" name="author" maxlength="80" value="{{request.POST.author|default:'Dr. Dos'}}">
</div>

<div class="field">
    <label for="title">Title<br>
        <span class="sub"></span>
    </label>
    <input id="title" name="title" maxlength="80" value="{{request.POST.title|default:'Livestream - '|add:file.title}}">
</div>

<div class="field">
    <label for="date">Date<br>
    </label>
    <div class="field-group">
        <input id="date" name="date" maxlength="10" type="date" value="{{request.POST.date|default:today}}"> <input type="button" value="Today" name="today">
    </div>
</div>

<div class="field">
    <label for="url">Video URL<br>
        <span class="sub">https://youtu.be/<b>{id}</b>,<br>
        https://www.youtube.com/watch?v=<b>{id}</b>&amp;feature=youtu.be, or<br>
        https://studio.youtube.com/video/<b>{id}</b>/edit format.</span>
    </label>
    <div class="field-group">
        <input id="url" name="url" maxlength="150" value="{{request.POST.url}}">
        {% if video_id %}<div>({{video_id}})</div>{% endif %}
    </div>
</div>

<div class="field">
    <label for="desc">Description<br>
        <span class="sub">Copy/Paste from YouTube video details editor.<br>
        Everything from "Download:" onward will be removed.</span>
    </label>
    <textarea id="desc" name="desc">{{request.POST.desc}}</textarea>
</div>

<div class="field">
    <label for="summary">Summary<br>
    </label>
    <input id="summary" name="summary" maxlength="150" value="{{request.POST.summary}}">
</div>

<div class="field">
    <label for="preview">Preview Image<br>
        <span class="sub">Leaving blank will use existing image if there is one.</span>
    </label>
    <input id="preview" name="preview" type="file" accept=".png">
</div>

<div class="field">
    <label for="480crop">Crop Preview Image<br>
        <span class="sub">Crop the preview image to 480x350 (intended for ZZT screenshots)</span>
    </label>
    <input id="480crop" name="480crop" type="checkbox" value="480crop" checked>
</div>

<div class="field">
    <label for="published">Publication Status<br>
    </label>
    <select id="published" name="published">
        <option value="1"{% if request.POST.published == "1" %} selected {% endif %}>Published</option>
        <option value="2"{% if request.POST.published == "2" %} selected {% endif %}>Upcoming</option>
        <option value="3"{% if request.POST.published == "3" %} selected {% endif %}>Unpublished</option>
    </select>
</div>

<div class="field">
    <label for="series">Add to Series<br>
    </label>
    <select id="series" name="series">
        <option value="None">- None -</option>
        {% for series in series_choices %}
        <option value="{{series.id}}">{{series.title}}</option>
        {% endfor %}
    </select>
</div>

{% comment %}
<div class="field">
    <label for="series">File Associations<br>
        <span class="sub">The specified file is pre-checked. Add additional file associations here if needed.</span>
    </label>
    <div class="scrolling-checklist">
        {% for fc in file_choices %}
            <label><input type="checkbox" name="file_associations" value="{{fc.id}}"{% if fc.id == file.pk %} checked{% endif %}> {{fc.title}}</label>
        {% endfor %}
    </div>
</div>
{% endcomment %}

{% with file_associations as field %}
<div class="field-wrapper{% if field.errors %} field-with-error{% endif %}" data-field="{{field.name}}">
    {{field.errors}}
    {{field.label_tag}}
    <div class="field-value">
        {{field}}
    </div>
    {% if field.help_text %}
    <p class="field-help">{{field.help_text|safe}}</p>
    {% endif %}
</div>
{% endwith %}

<div class="field">
    <button type="submit" id="submit-button">Create VOD Article</button>
</div>

<div class="field">
    <label for="pk">PK Override (to edit existing article)<br>
    </label>
    <input type="pk" name="pk" value="{{article_pk}}">
</div>
</form>
{% if article_pk %}
<a href="/article/{{article_pk}}/preview" target="_blank">View Article</a>
{% endif %}
{% endblock %}
